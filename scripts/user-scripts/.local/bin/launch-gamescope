#!/usr/bin/env bash

# Gamescope options
GAMESCOPE_ARGS=(
    # --- Display & Resolution ---
    -w 2560 -h 1440        # Internal resolution: The resolution the game "sees"
    -W 1920 -H 1080        # Output resolution: what is sent to your monitor
    -r 165                 # Target refresh rate
    --hdr-enabled          # Enables High Dynamic Range support
    --fullscreen           # Start Gamescope in fullscreen mode

    # Scheduling
    --rt                   # Real-time scheduling

    # --- HDR & Sync Features ---
    --adaptive-sync        # Enables VRR (FreeSync/G-Sync) support
    --immediate-flips      # Reduces latency by skipping VSync (can cause tearing)

    # --- Hardware & Performance ---
    --prefer-vk-device 0   # Forces usage of the first Vulkan device (usually primary GPU)
    --disable-layers       # Disables Vulkan layers (useful for compatibility/performance)

    # --- Input Control ---
    --mouse-sensitivity 1.0 # Sets the mouse scale factor
    --force-grab-cursor     # Keeps the mouse locked inside the game window
)

# Steam options
STEAM_OPTS=(
)

# check if in DE or TTY
if [[ -z "$display" && -z "$wayland_display" ]]; then
    echo "running embedded gamescope"
    gamescope_args+=(
        --backend drm   # Enables backend drm for embedded mode
        # --steam         # Enables steam integration features (overlays/steam menu)
    )
    steam_opts+=(
        -steamos3
        -gamepadui
    )
else
    echo "running nested gamescope"
    steam_opts+=(
    )
fi

exec gamescope "${GAMESCOPE_ARGS[@]}" -- steam "${STEAM_OPTS[@]}" #2> ~/gamescope_error.log 
