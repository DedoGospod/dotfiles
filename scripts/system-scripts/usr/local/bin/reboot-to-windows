#!/usr/bin/env bash

# Request sudo upfront
sudo -v

# Import logs
LIB_FOLDER="$HOME/.local/lib/snippets/"
# shellcheck source=/dev/null
source "$LIB_FOLDER/logs"

# Set next boot to Windows via efibootmgr
if ! sudo efibootmgr | grep -q "Windows"; then
    warn "No Windows UEFI entry found."
else
    WINDOWS_BOOTNUM=$(sudo efibootmgr | grep "Windows" | sed 's/Boot\([0-9A-F]*\).*/\1/')
    sudo efibootmgr --bootnext "$WINDOWS_BOOTNUM"
fi

# Execution
read -rp "Reboot to Windows now? (y/N): " confirm
if [[ "$confirm" =~ ^[yY] ]]; then
    sudo reboot
else
    log "Staged. Your next manual reboot will go to Windows."
fi
