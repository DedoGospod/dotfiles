#################
### MONITORS ###
#################

# Automatically configure all monitors to use the highest available refresh rate & resolution, automatically position them, and apply a scaling factor of 1 (no scaling)
monitor= ,highres@highrr, auto, 1 

###################
### MY PROGRAMS ###
###################

# Define the programs you frequently use for easy access and keybindings
$terminal = kitty              # Set Kitty as the default terminal emulator
$fileManager = nautilus        # Set Nautilus as the default file manager
$menu = wofi --show drun       # Set Wofi as the application launcher
$browser = brave               # Set Brave as the default browser
$pypr = /usr/bin/pypr-client   # Pyprland client
$hyprscripts = $HOME/dotfiles/hypr/.config/hypr/hyprscripts # hyprland scripts directory

#################
### AUTOSTART ###
#################

# Desktop integration
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP  # Update DBus environment for Wayland
exec-once = systemctl --user start xdg-desktop-portal                                         # Autostart desktop portal
exec-once = sh -c "sleep 2 && $hyprscripts/theme-and-gsettings.sh"                            # Automatically configure theme and gsettings

#############################
### ENVIRONMENT VARIABLES ###
#############################

# Cursor
env = HYPRCURSOR_THEME,Adwaita
env = HYPRCURSOR_SIZE,24

#####################
### LOOK AND FEEL ###
#####################

# General settings for gaps, borders, and layout.
general {
    gaps_in = 2                     # Gap between windows
    gaps_out = 2                    # Gap between windows and screen edges
    border_size = 2                 # Border width for windows

    # Border colors for active and inactive windows.
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg   # Gradient for active window borders.
    col.inactive_border = rgba(595959aa)                      # Solid color for inactive window borders

    resize_on_border = true         # Allow resizing windows by dragging their borders.
    allow_tearing = true            # Enable/Disable screen tearing (similar to vsync)
    layout = dwindle                # Use the dwindle layout by default (tiling windows)
}

# Render settings
render {
direct_scanout = false              # Enable/Disable direct scanout
new_render_scheduling = true        # Dynamically switches to triple buffering if your system lags, giving better FPS without adding latency when performance is good
}

# Cursor settings
cursor {
    no_hardware_cursors = false     # Hardware cursors have lower latency
    use_cpu_buffer = true           # Essential for NVIDIA latency. CPU buffers are now "no-downside" and provide the smoothest movement on modern drivers.
}

# Decoration settings for window appearance.
decoration {
    rounding = 10                   # Round the corners of windows

    # Window transparency settings.
    active_opacity = 1.0            # Active windows are fully opaque
    inactive_opacity = 1.0          # Inactive windows are fully opaque

    # Shadow settings for windows.
    shadow {
        enabled = true              # Enable shadows for windows
        range = 4                   # Shadow range (size)
        render_power = 3            # Shadow sharpness
        color = rgba(1a1a1aee)      # Shadow color
    }

    # Blur settings for window backgrounds.
    blur {
        enabled = true              # Enable blur effect
        size = 3                    # Blur size
        passes = 1                  # Number of blur passes
        vibrancy = 0.1696           # Blur vibrancy (intensity)
    }
}

# Animation settings for smooth window transitions.
animations {
    enabled = yes                   # Enable animations

    # Define Bezier curves for smooth transitions.
    bezier = easeOutQuint, 0.23, 1, 0.32, 1
    bezier = easeInOutCubic, 0.65, 0.05, 0.36, 1
    bezier = linear, 0, 0, 1, 1
    bezier = almostLinear, 0.5, 0.5, 0.75, 1.0
    bezier = quick, 0.15, 0, 0.1, 1

    # Configure animations for various actions.
    animation = global, 1, 10, default
    animation = border, 1, 5.39, easeOutQuint
    animation = windows, 1, 4.79, easeOutQuint
    animation = windowsIn, 1, 4.1, easeOutQuint, popin 87%
    animation = windowsOut, 1, 1.49, linear, popin 87%
    animation = fadeIn, 1, 1.73, almostLinear
    animation = fadeOut, 1, 1.46, almostLinear
    animation = fade, 1, 3.03, quick
    animation = layers, 1, 3.81, easeOutQuint
    animation = layersIn, 1, 4, easeOutQuint, fade
    animation = layersOut, 1, 1.5, linear, fade
    animation = fadeLayersIn, 1, 1.79, almostLinear
    animation = fadeLayersOut, 1, 1.39, almostLinear
    animation = workspaces, 1, 1.94, almostLinear, fade
    animation = workspacesIn, 1, 1.21, almostLinear, fade
    animation = workspacesOut, 1, 1.94, almostLinear, fade
}

# Dwindle layout settings for tiling behavior.
dwindle {
    pseudotile = true               # Enable pseudotiling (fake tiling for floating windows)
    preserve_split = true           # Preserve split ratios when resizing windows
}

# Master layout settings (not used in this configuration)
master {
    new_status = dwindle
}

# Miscellaneous settings.
misc {
    force_default_wallpaper = 0     # Disable forced wallpaper
    disable_hyprland_logo = false   # Show the Hyprland logo
    vrr = 0 			                  # Enable/Disable variable refresh rate
    disable_watchdog_warning = true # Disable startup warning (since i use uwsm start instead)
}

#############
### INPUT ###
#############

# Input settings for keyboard and mouse.
input {
    kb_layout = us                  # Set the keyboard layout to US
    follow_mouse = 1                # Focus follows the mouse pointer
    sensitivity = 0                 # Set mouse sensitivity (0 means no adjustment)

    touchpad {
        natural_scroll = false      # Disable natural scrolling for touchpads
    }

    # Disable mouse acceleration for more precise control
    accel_profile = "flat"          # Disables acceleration
    force_no_accel = true           # Ensures raw input
}

# Gestures settings
gestures {
    gesture = 3, horizontal, workspace
    workspace_swipe_distance = 300
    workspace_swipe_invert = false
}

#############################
##### PERMISSION SYSTEM #####
#############################

# Enable permission system
ecosystem {
    enforce_permissions = true
}

# Applications that dont need to ask for permissions
permission = /usr/(lib|libexec|lib64)/xdg-desktop-portal-hyprland, screencopy, allow  # Desktop portal hyprland
permission = /usr/(bin|local/bin)/grim, screencopy, allow                             # Screenshot utility
permission = /usr/(bin|local/bin)/hyprlock, screencopy, allow                         # Hyprland screen locker

###################
### KEYBINDINGS ###
###################

# Main mainModifier key (Super/Windows key).
$mainMod = SUPER

# Application keybinds for quick access.
bind = $mainMod, Q, exec, $terminal                       # Open terminal
bind = $mainMod, SPACE, exec, $menu                       # Open application launcher
bind = $mainMod, E, exec, $fileManager --new-window       # Open file manager
bind = $mainMod, W, exec, $browser                        # Open browser
bind = $mainMod, N, exec, swaync-client -t -sw            # Toggle notifications
bind = $mainMod, M, exec, flatpak run com.stremio.Stremio # Open Stremio

# Screenshot utility keybinds.
bind = $mainMod, P, exec, hyprshot -m window              # Screenshot active window
bind = $mainMod SHIFT, P, exec, hyprshot -m region        # Screenshot selected region

# Window management keybinds.
bind = $mainMod, C, killactive            # Close the active window
bind = $mainMod SHIFT, M, exit            # Exit Hyprland and return to TTY
bind = $mainMod SHIFT, V, togglefloating  # Toggle floating/tiling mainMode
bind = $mainMod SHIFT, T, togglesplit     # Toggle window split orientation
bind = $mainMod, F, fullscreen            # Toggle fullscreen

# Custom scripts and tools
bind = $mainMod, I, exec, $hyprscripts/idle-inhibitor.sh  # idle-inhibitor
bind = $CTRL, backslash, exec, hyprctl dispatch pass "class:^(com\.obsproject\.Studio)$" && $hyprscripts/obs-replay-notification.sh  # Save replay and send notification

# Move focus between windows using VIM-style keys
bind = $mainMod, h, movefocus, l  # Move focus left
bind = $mainMod, l, movefocus, r  # Move focus right
bind = $mainMod, k, movefocus, u  # Move focus up.
bind = $mainMod, j, movefocus, d  # Move focus down

# Resize windows using VIM-style keys.
bind = $mainMod SHIFT, h, resizeactive, -20 0  # Shrink width
bind = $mainMod SHIFT, l, resizeactive, 20 0   # Expand width
bind = $mainMod SHIFT, k, resizeactive, 0 -20  # Shrink height
bind = $mainMod SHIFT, j, resizeactive, 0 20   # Expand height

# Switch between workspaces.
bind = $mainMod, 1, workspace, 1  # Switch to workspace 1
bind = $mainMod, 2, workspace, 2  # Switch to workspace 2
bind = $mainMod, 3, workspace, 3  # Switch to workspace 3
bind = $mainMod, 4, workspace, 4  # Switch to workspace 4
bind = $mainMod, 5, workspace, 5  # Switch to workspace 5
bind = $mainMod, 6, workspace, 6  # Switch to workspace 6
bind = $mainMod, 7, workspace, 7  # Switch to workspace 7
bind = $mainMod, 8, workspace, 8  # Switch to workspace 8
bind = $mainMod, 9, workspace, 9  # Switch to workspace 9
bind = $mainMod, 0, workspace, 10 # Switch to workspace 10

# Move active window to a workspace without switching.
bind = $mainMod SHIFT, 1, movetoworkspacesilent, 1  # Move to workspace 1
bind = $mainMod SHIFT, 2, movetoworkspacesilent, 2  # Move to workspace 2
bind = $mainMod SHIFT, 3, movetoworkspacesilent, 3  # Move to workspace 3
bind = $mainMod SHIFT, 4, movetoworkspacesilent, 4  # Move to workspace 4
bind = $mainMod SHIFT, 5, movetoworkspacesilent, 5  # Move to workspace 5
bind = $mainMod SHIFT, 6, movetoworkspacesilent, 6  # Move to workspace 6
bind = $mainMod SHIFT, 7, movetoworkspacesilent, 7  # Move to workspace 7
bind = $mainMod SHIFT, 8, movetoworkspacesilent, 8  # Move to workspace 8
bind = $mainMod SHIFT, 9, movetoworkspacesilent, 9  # Move to workspace 9
bind = $mainMod SHIFT, 0, movetoworkspacesilent, 10 # Move to workspace 10

# Special workspace (scratchpad) keybinds.
bind = $mainMod, S, togglespecialworkspace, magic               # Toggle special workspace
bind = $mainMod SHIFT, S, movetoworkspacesilent, special:magic  # Move window to special workspace

# Scroll through workspaces with the mouse.
bind = $mainMod, mouse_down, workspace, e+1  # Scroll to the next workspace
bind = $mainMod, mouse_up, workspace, e-1    # Scroll to the previous workspace

# Move windows with the mouse.
bindm = $mainMod, mouse:272, movewindow      # Move window with left click + Super

# Pyprland
bind = $mainMod SHIFT, Q, exec, $pypr toggle obsidian    # Obsidian scratchpad
bind = $mainMod SHIFT, A, exec, $pypr toggle pavucontrol # Pavucontrol scratchpad

# Gamma controls
bindel = SUPER, minus, exec, hyprctl hyprsunset gamma -10
bindel = SUPER, equal, exec, hyprctl hyprsunset gamma +10

# Multimedia keybinds.
bindel = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+     # Increase volume
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-     # Decrease volume
bindel = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle           # Toggle mute
bindel = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle      # Toggle microphone mute
bindel = , XF86MonBrightnessUp, exec, brightnessctl s 10%+                           # Increase brightness
bindel = , XF86MonBrightnessDown, exec, brightnessctl s 10%-                         # Decrease brightness

# Media player controls.
bindl = , XF86AudioNext, exec, playerctl next         # Play next track
bindl = , XF86AudioPause, exec, playerctl play-pause  # Pause/play track
bindl = , XF86AudioPlay, exec, playerctl play-pause   # Pause/play track
bindl = , XF86AudioPrev, exec, playerctl previous     # Play previous track

##############################
### WINDOWS AND WORKSPACES ###
##############################

# Suppress maximize events for all windows (using regex .*)
windowrule = suppress_event maximize, match:class .*

# Fix for phantom windows (empty class/title, xwayland, floating, not fullscreen)
windowrule = no_initial_focus 1, match:class ^$, match:title ^$, match:xwayland 1, match:float 1, match:fullscreen 0

# Floating windows
windowrule = float 1, match:title ^(Unlock Database - KeePassXC)$
windowrule = float 1, match:title ^(KeePassXC - Browser Access Request)$

# Application windowrules
windowrule = workspace 9 silent, match:class virt-manager
windowrule = workspace 8 silent, match:class org.kde.kdenlive
windowrule = workspace 4 silent, match:class com.discordapp.Discord
windowrule = workspace 3 silent, match:class com.stremio.stremio
windowrule = workspace special:magic silent, match:class com.obsproject.Studio

# Gaming windowrules
windowrule = immediate 1, workspace 10 silent, fullscreen 1, suppress_event fullscreen, match:class ^(steam_app_.*)$
windowrule = immediate 1, workspace 10 silent, fullscreen 1, suppress_event fullscreen, match:class ^(steam_proton.*)$
windowrule = immediate 1, workspace 10 silent, fullscreen 1, suppress_event fullscreen, match:class gamescope
windowrule = workspace 4 silent, match:class steam

# Workaround for Steam games that ignore workspace 10 rules
windowrule = immediate 1, workspace 10 silent, fullscreen 1, suppress_event fullscreen, match:class tf_linux64
windowrule = immediate 1, workspace 10 silent, fullscreen 1, suppress_event fullscreen, match:class cs2
