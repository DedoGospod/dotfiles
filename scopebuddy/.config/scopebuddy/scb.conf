# This is the config file that let's you assign defaults for gamescope when using the scopebuddy script
# lines starting with # are ignored
# Conf files matching the games Steam AppID stored in ~/.conf/scopebuddy/AppID/ will be sourced after
# ~/.config/scopebuddy/scb.conf or whichever file you specify with SCB_CONF=someotherfile.conf env var in the launch options.
# 
# Example for always exporting specific environment variables for gamescope
#export XKB_DEFAULT_LAYOUT=no
#export MANGOHUD_CONFIG=preset=2
#
# Example for providing default gamescope arguments through scopebuddy if no arguments are given to the scopebuddy script, this does not need to be exported.
# To not use this default set of arguments, just launch scb with SCB_NOSCOPE=1 or just add any gamescope argument before the '-- %command%' then this variable will be ignored
#SCB_GAMESCOPE_ARGS="--mangoapp -f -w 2560 -h 1440 -W 2560 -H 1440 -r 180 --force-grab-cursor --hdr-enabled -e"
#
# To auto-detect display width, height, refresh, VRR and HDR states, you can use SCB_AUTO_* {RES|HDR|VRR}
# These vars will override any previously set values for -W and -H or append --hdr-enabled and --adaptive-sync
# automatically depending on the current settings for your active display, or the display chosen with -O /
# --prefer-output flags in gamescope. This works on both KDE (via kscreen-doctor) and GNOME (via gdctl).
#SCB_AUTO_RES=1
#SCB_AUTO_HDR=1
#SCB_AUTO_VRR=1
# For GNOME users: you can use either gdctl or gnome-randr for auto-detection
# gdctl requires upstream version with --format=json support (will be tested automatically)
# gnome-randr will be used as fallback if gdctl test fails
# To specify a custom gdctl build (must support 'gdctl show --format=json'):
#export GDCTL_COMMAND="$HOME/.local/bin/gdctl-mr4708"
# To debug scopebuddy output, uncomment the following line. After launching games, the executed cmd will be output to ~/.config/scopebuddy/scopebuddy.log
#SCB_DEBUG=1
###
## FOR ADVANCED USE INSIDE AN APPID CONFIG
###
# The config files are treated as a bash script by scopebuddy, this means you can use bash to do simple tasks before the game runs
# or you can check which mode scopebuddy is running in and apply settings accordingly, below are some handy variables for scripting.
# $SCB_NOSCOPE will be set to 1 if we are running in no gamescope mode
# $SCB_GAMEMODE will be set to 1 if we are running inside steam gamemode (which means SCB_NOSCOPE will also be set to 1 due to nested gamescope not working in gamemode)
# $command will contain everything steam expanded %command% into

# Dont use gamescope
export SCB_NOSCOPE=1

# Set Nvidia gpu to prefer max performance (If a nvidia gpu is in use)
if command -v nvidia-smi &> /dev/null && nvidia-smi &> /dev/null; then
    nvidia-settings -a "[gpu:0]/GPUPowerMizerMode=1" &> /dev/null
fi

# Global Linux Gaming Tweaks
export PROTON_USE_NTSYNC=1       # Faster kernel-level syncing
export PROTON_DLSS_UPGRADE=1     # Allow swapping DLSS versions
export PROTON_ENABLE_NVAPI=1     # Enable Nvidia features in games
export OBS_VKCAPTURE=1           # Enable OBS game capture for Vulkan

# Shader cache options
export __GL_SHADER_DISK_CACHE_SKIP_CLEANUP=1
export __GL_SHADER_DISK_CACHE_SIZE=10737418240

# Kernel Detection & Wrapper Selection
if [[ $(uname -r) == *"cachyos"* ]]; then
    if command -v game-performance &> /dev/null; then
        command="game-performance $command"
    fi
else
    # We are on a standard kernel - Use GameMode
    if command -v gamemoderun &> /dev/null; then
        command="gamemoderun $command"
    fi
fi

# command="mangohud $command"

### Uncomment to enable logs for debugging ###
# export SCB_DEBUG=1
